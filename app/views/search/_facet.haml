- unless facet.last['terms'].empty?
  - ns = facet.first.split('.').first
  - name = facet.first.split('.').last

  %li.nav-header= I18n.t("resource.#{name}", :default => name.to_s.underscore.humanize) unless 'rdf_types' == name

  - facet.last['terms'].each do |f|

    - if f['term'].match(/^[0-9a-f]{24}$/)
      - heading = @headings.results.find {|i| i.id == f['term']}.heading rescue []
      -# FIXME: heading in LCSH heirarchy has changed
      - if 'dcterms.subject' == facet.first then display = heading.dashjoin
      - else display = heading.first.truncate(100, :separator => ' ') rescue ''

    - elsif 'dcterms.language' == facet.first
      - if 'fr' == I18n.locale.to_s then display = ISO_639.find(f['term']).french_name.titleize rescue f['term']
      - else display = ISO_639.find(f['term']).english_name rescue f['term']

    - elsif 'dcterms.format' == facet.first
      - display = f['term'].capitalize

    - elsif 'type' == facet.first or 'rdf_types' == facet.first
      - display = partial 'image', :locals => {:type => f['term'].underscore, :style => 'font-size: 1.5em;'}
      - display = display + f['term'].underscore.humanize

    - else display = f['term']

    - if @filters[ns].nil? or @filters[ns][name].nil? or !@filters[ns][name].to_a.include?(f['term'])
      - if @filters[ns].nil?
        - @new_fi = @filters.deep_merge({ns.to_s => {name => f['term'].to_a}})
      - else
        - @new_fi = @filters.deep_merge({ns.to_s => {name => @filters[ns][name].to_a | f['term'].to_a}})

      - if @results.total == f['count']
        %li.active
          %a= display
      - else
        %li= link_to display + " (#{f['count']})", current_path('page' => @page, 'fi' => @new_fi)

    - else
      %li.active= link_to display, current_path('page' => @page, 'fi' => @filters.deep_merge({ns.to_s => {name => @filters[ns][name].reject { |x| f['term'] == x}}}))
